{% extends 'PlanItBudgetBundle::layout.html.twig' %}

{% block content %}
<div class="container">
	<div class="row" id="title">
        <div class="col-md-12" > <h1>{{'budget'|trans}}</h1> </div>
    </div>

	<div class="row" id="separator">
		<div class="col-md-12"> </div>
	</div>

	<div class="row buttons">
		<!-- <div class="col-md-3 col-sm-3 col-xs-12 bt_budget"><button id="bouton_depense" data-toggle="modal" data-target=".addTypeExpenseModal" data-type="0" data-id="{{module.id}}">Ajouter une dépense</button></div>
		<div class="col-md-3 col-sm-3 col-xs-12 bt_budget"><button id="bouton_ajout" data-toggle="modal" data-target=".addInflowModal" data-type="1" data-id="{{module.id}}">Ajouter un apport</button></div>
		<div class="col-md-3 col-sm-3 col-xs-12 bt_budget"><a href="{{ path('PlanItBudgetBundle_pdf', { 'module_id': module.id }) }}"><button>Imprimer la liste de courses</button></a></div> -->

		<div class="col-md-3 col-sm-3 col-xs-12 bt_budget"><button id="bouton_depense" data-toggle="modal" data-target=".addTypeExpenseModal" data-type="0" data-id="{{module.id}}">{{'add_expense'|trans}}</button></div>
		<div class="col-md-3 col-sm-3 col-xs-12 bt_budget"><button id="bouton_ajout" data-toggle="modal" data-target=".addInflowModal" data-type="1" data-id="{{module.id}}">{{'add_inflow'|trans}}</button></div>

	</div>
	
	<section>			
		<div class="container_onglet">			
			<section>
				<div class="tabs tabs-style-topline">
					<div class="row">
						<nav class="col-md-12">
							<ul id="tab">
								<li><a class="tab" id="tab-general" href="#section-topline-general"><span>{{'recap'|trans}}</span></a></li>
								{% for type_expense in module.typesexpense %}
									<li id="tab-{{type_expense.id}}"><a class="tab" href="#section-topline-{{type_expense.id}}"><span>{{type_expense.name}}</span>
										<span class="supp-type_expense" data-toggle="modal" data-target=".deleteTypeExpenseModal" data-type="{{type_expense.id}}" data-name="{{type_expense.name}}">x</span></a> 
									</li>
								{% endfor %}
								<li id="tab-apports" class="pull-right"><a href="#section-topline-apports"><span>{{'inflows'|trans}}</span></a></li>

								<div class="modal fade deleteTypeExpenseModal validate" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
								    <div class="modal-dialog">
								        <div class="modal-content">
								            <div class="modal-header">
								            <h4 class="modal-title" id="myModalLabel_deleteTypeExpense">{{'delete_typeexpense_message'|trans}}</h4>
								            </div>
								            <div class="modal-body row">
								                <button id="delete_confirm_typeexpense" class="btn btn-default col-md-6"> {{'yes'|trans}} </button>
								                <button id="delete_cancel" class="btn btn-default" class ="col-md-6" data-dismiss="modal"> {{'no'|trans}} </button>

								            </div>
								        </div>
								  </div>
								</div>
							</ul>
						</nav>
					</div>

					<div class="content-wrap" id="tab_content">						
						{# GENERAL #}
						<section id="section-topline-general">
							<div class="section-topline">
								<div class="col-md-4"> 
									<div class="pie_chart" id="pie_chart_depenses"></div>
								</div>

								<div class="col-md-4"> 
									<div class="pie_chart" id="pie_chart_apports"></div>		
								</div>

								<div class="col-md-4" id="infos"> 
									<div class="info_dte info_color" id="balance">
										<p class="benef" data-placement="top" data-original-title="(Apport personnel + Apports) - Dépenses"> {{'benefices'|trans}} </br> <span >{{infos.balance}} €</span> </p>
									</div>							
									<div class="info_dte">
										<img src="/images/budget/info_dte_limite.png" /> 
										<p> {{'max_budget'|trans}}</br> <span>{{infos.budget}} €</span> </p>
									</div>
								</div>
							</div>
						</section>

						{# TYPE ITEMS #}
						{% for type_expense in module.typesexpense %}
							<section  id="section-topline-{{type_expense.id}}">
								<div class="responsive-table-line section-topline">
									<table class="table table-bordered table-condensed table-body-center" >
										<thead>
											<tr>
												<th>{{'item'|trans}} *</th>
												<th>{{'quantity'|trans}} *</th>
												<th>{{'stock'|trans}} *</th>
												<th>{{'to_buy'|trans}}</th>
												<th>{{'unit_price'|trans}} *</th>
												<th>{{'total'|trans}}</th>
												<th>{{'consumed'|trans}} *</th>
												<th>{{'bought'|trans}} *</th>								
												<th>{{'delete'|trans}}</th>
											</tr>
										</thead>
										
										
										<tbody>
											{% for expense in type_expense.expenses %}
												<tr>
													<td data-title="Article">
														<input type="text" id="name-expense-{{expense.id}}" onblur="updateExpense({{expense.id}})" value="{{expense.name}}">
													</td>
													<td data-title="Quantité">
														<input type="text" id="quantity-expense-{{expense.id}}" onblur="updateExpense({{expense.id}})" value="{{expense.quantity}}"> {{expense.unit}}
													</td>
													<td data-title="En stock">
														<input type="text" id="stock-expense-{{expense.id}}" onblur="updateExpense({{expense.id}})" value="{{expense.stock}}">
													</td>
													<td data-title="A acheter">
														{{expense.quantity - expense.stock}}
													</td>
													<td data-title="Prix unitaire">
														<input type="text" id="price-expense-{{expense.id}}" onblur="updateExpense({{expense.id}})" value="{{expense.price}}">
													</td>
													<td data-title="Prix total">
														{{expense.price * (expense.quantity - expense.stock)}} €
													</td>
													<td data-title="Consommé">
														<input type="text" id="consummate-expense-{{expense.id}}" onblur="updateExpense({{expense.id}})" value="{{expense.consummate}}">
													</td>
													<td data-title="Acheté">
														<input id="bought-expense-{{expense.id}}" onclick="updateExpense({{expense.id}})" type="checkbox" {% if expense.bought %} checked {%endif%}/>
													</td>
													<td class="delete-expense" data-toggle="modal" data-target=".deleteExpenseModal" data-id="{{expense.id}}" data-name="{{expense.name}}" data-title="Supprimer">X</td>
												</tr>
											{% endfor %}						
										</tbody>
									</table>
									<span id="legend">* {{'changeable_data'|trans}}</span>
									<div class="col-md-2 pull-right add-expense"><button data-toggle="modal" data-type="{{type_expense.id}}" data-target=".addExpenseModal">{{'add_item'|trans}}</button></div>
									
								</div>
							</section>

						{% endfor %}
						<section id="section-topline-apports">
							<div class="responsive-table-line">
								<table class="table table-bordered table-condensed table-body-center" >
									<thead>
										<tr>
											<th>{{'label'|trans}}</th>
											<th>{{'amount'|trans}}</th>											
											<th>{{'delete'|trans}}</th>
										</tr>
									</thead>
									
									
									<tbody>
										{% for inflow in module.inflows %}
											<tr>
												<td data-title="Intitulé">
													<input type="text" id="name-inflow-{{inflow.id}}" onblur="updateInflow({{inflow.id}})" value="{{inflow.name}}">
												</td>
												<td data-title="Montant">
													<input type="text" id="amount-inflow-{{inflow.id}}" onblur="updateInflow({{inflow.id}})" value="{{inflow.amount}}">
												</td>
												<td class="delete-inflow" data-toggle="modal" data-target=".deleteInflowModal" data-id="{{inflow.id}}" data-name="{{inflow.name}}" data-title="Supprimer">X</td>
											</tr>
										{% endfor %}						
									</tbody>
								</table>

								<span id="legend">* {{'changeable_data'|trans}}</span>
								<div class="col-md-2 pull-right add-expense"><button data-toggle="modal" data-target=".addInflowModal">{{'add_inflow'|trans}}</button></div>

								
							</div>
						</section>
						<div class="modal fade deleteExpenseModal validate" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
						    <div class="modal-dialog">
						        <div class="modal-content">
						            <div class="modal-header">
						            <h4 class="modal-title" id="myModalLabel_deleteExpense"></h4>
						            </div>
						            <div class="modal-body row">
						                <button id="delete_confirm_expense" class="btn btn-default col-md-6"> {{'yes'|trans}} </button>
						                <button id="delete_cancel" class="btn btn-default" class ="col-md-6" data-dismiss="modal"> {{'no'|trans}} </button>

						            </div>
						        </div>
						  </div>
						</div>

						<div class="modal fade deleteInflowModal validate" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
						    <div class="modal-dialog">
						        <div class="modal-content">
						            <div class="modal-header">
						            <button id="close-modal" type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
						            <h4 class="modal-title" id="myModalLabel_deleteInflow"></h4>
						            </div>
						            <div class="modal-body row">
						                <button id="delete_confirm_inflow" class="btn btn-default col-md-6"> {{'yes'|trans}} </button>
						                <button id="delete_cancel" class="btn btn-default" class ="col-md-6" data-dismiss="modal"> {{'no'|trans}} </button>

						            </div>
						        </div>
						  </div>
						</div>
					</div><!-- /content -->
					{{ render(controller('PlanItBudgetBundle:TypeExpense:form', { 'module_id' : module.id } ))}}
					{{ render(controller('PlanItBudgetBundle:Inflow:form', { 'module_id' : module.id } ))}}
					{{ render(controller('PlanItBudgetBundle:Expense:form', { 'module_id' : module.id } ))}}

				</div><!-- /tabs -->
			</section>
			
		</div><!-- /container -->	

	</section>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }} <!-- pour ne pas effacer les autres feuilles de style -->
    <script> //getEvent({{event_id}}); </script>

 <script>
		(function() {
			[].slice.call( document.querySelectorAll( '.tabs' ) ).forEach( function( el ) {
				new CBPFWTabs( el );
			});
		})();

</script>
<script>budget();</script>
<script>getListInflow({{module.id}});</script>
<script>getListExpense({{module.id}});</script>
{% endblock %}
