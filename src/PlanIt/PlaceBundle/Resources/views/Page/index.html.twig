{% extends 'PlanItPlaceBundle::layout.html.twig' %}

{% block content %}

 <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<div class="container">
	<div class="row" id="title">
        <div class="col-md-10"> <h1>{{'place'|trans}}</h1> </div>
        <div class="col-md-2 pull-right bt_place">
            <button data-toggle="modal" data-target=".updateModuleModal" data-type="">{{'update_module'|trans}}</button>
        </div>
    </div>

	<div class="row" id="separator">
		<div class="col-md-12"> </div>
	</div>
	<div class="modal fade modal-ok" id="okModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                OK
            </div>
        </div>
    </div>
	<section>
	{% for message in app.session.flashbag.get('errors') %}
        <p>{{ message }}</p>
    {% endfor %}
	{{ render(controller('PlanItPlaceBundle:Page:updatemodule', { 'module_id' : module.id } ))}}
	<div class="row">
        <div class="col-md-3 bt_place"><button data-toggle="modal" data-target=".addPlaceModal" class="col-md-3">{{'add_place'|trans}}</button></div>
    </div>

	<div class="row list" id="list">
		{% for place in module.places%}
		<div id="place-{{place.id}}" class="place">
			<div class="div-checkbox">
				<input type="checkbox" class="check" id="check-{{place.id}}" onClick="chosePlace({{place.id}})" {% if place.state == 1 %} checked {% endif %}>
			</div>
			<div id="head_list" class="head-list accordion-head {% if place.state == 1 %} checked {% else %} nochecked {% endif %}">	
				<div class="name"><input type="text" id="name-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.name}}"></div>
			    <div class="price"><input type="text" id="price-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.price}}">â‚¬</div>
			    <button onclick="showModalDeletePlace({{place.id}}, '{{place.name}}')">X</button>
			</div>
			<div class="accordion-body">
			    <div class="labels row">
			    	<div class="col-lg-3 col-md-12 col-sm-12 img_place">
			    		{% if place.image != null %}
			    			<img src="/images/place/places_pictures/{{place.image}}" width="100%"/>
			    		{% else %}
			    			<img src="/images/no-image.jpg" width="100%"/>
			    		{% endif %}
							<div class="bt_place">
			                    <button data-toggle="modal" data-target=".updateImageModal" data-id="{{place.id}}">{{'update_image'|trans}}</button> 
			                </div>
			        </div>
			    	<div class="col-lg-4 col-md-6 col-sm-12" id="infos">
			        	<p><span class="label_descr">{{'address'|trans}}</span> : <input type="text" id="address-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.address}}"></p>
			        	<p><span class="label_descr">{{'capacity'|trans}}</span> : <input type="text" id="capacity-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.capacity}}"></p>
			        	<p><span class="label_descr">{{'distance'|trans}}</span> : <input type="text" id="distance-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.distance}}">km</p>
			        	<p><span class="label_descr">{{'tel'|trans}}</span> : <input type="text" id="tel-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.tel}}"></p>
			        	<p><span class="label_descr">{{'website'|trans}}</span> : <input type="text" id="website-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.website}}"> </p>
			        	<p><span class="label_descr">{{'remark'|trans}}</span> : <input type="text" id="remark-place-{{place.id}}" onblur="updatePlace({{place.id}})" value="{{place.remark}}"> </p>
			        	<p><span class="label_descr">{{'state'|trans}}</span> : 
			        		<select id="state-place-{{place.id}}" onchange="updatePlace({{place.id}})">
			        			<option value="0" {% if place.state == 0 %} selected {% endif %}>{{'refused'|trans}}</option>
			        			<option value="2" {% if place.state == 2 %} selected {% endif %}>{{'contacted'|trans}}</option>
			        			<option value="3" {% if place.state == 3 %} selected {% endif %}>{{'tocontact'|trans}}</option>
			        			<option value="1" {% if place.state == 1 %} selected {% endif %}>{{'accepted'|trans}}</option>
			        		</select>
			        	</p>
			        	<p><span class="label_descr">{{'contract'|trans}}</span> : <a target="_blank" href="/files/place/contracts/{{place.contract}}">{{place.contract}} </a>
			                <div class="bt_place">
			                    <button data-toggle="modal" data-target=".updateContractModal" data-id="{{place.id}}">{{'update_contract'|trans}}</button> 
			                </div>
			        	</p>
			    	</div>
			    	<div class="col-lg-5 col-md-6 col-sm-12" id="map_canvas_{{place.id}}">
			    	</div>

			    </div>
			</div>
		</div>
		{% endfor %}
	</div>
	<div class="modal fade deletePlaceModal validate" id="basicModal" tabindex="-1" role="dialog" aria-labelledby="basicModal" aria-hidden="true">
	    <div class="modal-dialog">
	        <div class="modal-content">
	            <div class="modal-header">
	            <button id="close-modal" type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
	            <h4 class="modal-title" id="myModalLabel_deletePlace"></h4>
	            </div>
	            <div class="modal-body row">
	                <button id="delete_confirm_place" class="btn btn-default col-md-6"> {{'yes'|trans}} </button>
	                <button id="delete_cancel" class="btn btn-default" class ="col-md-6" data-dismiss="modal"> {{'no'|trans}} </button>

	            </div>
	        </div>
	  </div>
	</div>
     {{ render(controller('PlanItPlaceBundle:Place:form', { 'module_id' : module.id } ))}}
     {{ render(controller('PlanItPlaceBundle:Place:contract', { 'module_id' : module.id } ))}}
     {{ render(controller('PlanItPlaceBundle:Place:image', { 'module_id' : module.id } ))}}

	
	</section>
</div>

{% endblock %}

{% block javascripts %}
    {{ parent() }} <!-- pour ne pas effacer les autres feuilles de style -->
    <script>accordeonPlace();</script>
    <script>initializeMap(1);</script>
    <script>places();</script>
{% endblock %}
